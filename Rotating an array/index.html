<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Array Rotation Visualizer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
        }

        .main-content {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .controls-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            height: fit-content;
        }

        .visualization-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            min-height: 500px;
        }

        .explanation-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-top: 20px;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #4a5568;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 8px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3748;
        }

        .input-group input, .input-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .input-group input:focus, .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .slider {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: #e2e8f0;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
        }

        .preset-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-success:hover {
            background: #38a169;
        }

        .btn-warning {
            background: #ed8936;
            color: white;
        }

        .btn-warning:hover {
            background: #dd6b20;
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-danger:hover {
            background: #e53e3e;
        }

        .control-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .algorithm-selector {
            margin-bottom: 20px;
        }

        .algorithm-tabs {
            display: flex;
            background: #f7fafc;
            border-radius: 8px;
            padding: 4px;
            margin-bottom: 15px;
        }

        .algorithm-tab {
            flex: 1;
            padding: 8px 12px;
            text-align: center;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 12px;
            font-weight: 600;
        }

        .algorithm-tab.active {
            background: #667eea;
            color: white;
        }

        .algorithm-tab:not(.active):hover {
            background: #e2e8f0;
        }

        .code-tabs {
            display: flex;
            background: #f7fafc;
            border-radius: 8px;
            padding: 4px;
            margin-bottom: 15px;
        }

        .code-tab {
            flex: 1;
            padding: 8px 12px;
            text-align: center;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 12px;
            font-weight: 600;
        }

        .code-tab.active {
            background: #48bb78;
            color: white;
        }

        .code-tab:not(.active):hover {
            background: #e2e8f0;
        }

        .code-block {
            background: #1a202c;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin-bottom: 15px;
            white-space: pre-wrap;
        }

        .array-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            align-items: center;
            min-height: 200px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .array-element {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            background: white;
            border: 3px solid #e2e8f0;
            border-radius: 10px;
            min-width: 60px;
            transition: all 0.5s ease;
            position: relative;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .array-element.moving {
            transform: scale(1.1);
            z-index: 10;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .array-element.highlighted {
            border-color: #667eea;
            background: #ebf4ff;
        }

        .array-element.active {
            border-color: #48bb78;
            background: #f0fff4;
        }

        .array-element.visited {
            border-color: #ed8936;
            background: #fffaf0;
        }

        .element-value {
            font-size: 18px;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .element-index {
            font-size: 12px;
            color: #718096;
            font-weight: 600;
        }

        .arrow {
            position: absolute;
            color: #667eea;
            font-size: 20px;
            font-weight: bold;
            z-index: 5;
            transition: all 0.5s ease;
        }

        .step-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background: #f7fafc;
            border-radius: 8px;
        }

        .step-counter {
            font-weight: bold;
            color: #4a5568;
        }

        .speed-control {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .explanation-text {
            font-size: 16px;
            line-height: 1.6;
            color: #4a5568;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .complexity-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .complexity-card {
            background: #f7fafc;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .complexity-card h4 {
            color: #2d3748;
            margin-bottom: 8px;
        }

        .complexity-card .big-o {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
        }

        .before-after {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .before-after h4 {
            text-align: center;
            margin-bottom: 10px;
            color: #4a5568;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
            color: #667eea;
            font-weight: bold;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #2d3748;
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            font-size: 12px;
            font-weight: normal;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .preset-buttons {
                grid-template-columns: 1fr;
            }
            
            .control-buttons {
                grid-template-columns: 1fr;
            }
        }

        .keyboard-hint {
            font-size: 12px;
            color: #718096;
            margin-top: 10px;
            text-align: center;
        }

        .code-explanation {
            background: #f0f8ff;
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 20px;
            margin-top: 15px;
        }

        .code-explanation h4 {
            color: #2d3748;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }

        .code-explanation ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .code-explanation li {
            margin: 8px 0;
            line-height: 1.5;
        }

        .code-explanation code {
            background: #e2e8f0;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #2d3748;
        }

        .code-explanation p {
            margin: 10px 0;
        }

        .code-explanation strong {
            color: #4a5568;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔄 Array Rotation Visualizer</h1>
            <p>Watch how arrays rotate to the right by k steps! Perfect for understanding this classic algorithm problem with three different approaches.</p>
        </div>

        <div class="main-content">
            <div class="controls-panel">
                <div class="section-title">🎮 Controls</div>
                
                <div class="input-group">
                    <label for="arrayInput">Array (comma-separated numbers):</label>
                    <textarea id="arrayInput" rows="3" placeholder="1,2,3,4,5,6,7">1,2,3,4,5,6,7</textarea>
                </div>

                <div class="input-group">
                    <label for="kSlider">Rotation steps (k):</label>
                    <div class="slider-container">
                        <input type="range" id="kSlider" class="slider" min="0" max="10" value="3">
                        <input type="number" id="kInput" min="0" max="100" value="3" style="width: 60px;">
                    </div>
                </div>

                <div class="preset-buttons">
                    <button class="btn btn-primary" onclick="loadExample1()">Example 1</button>
                    <button class="btn btn-primary" onclick="loadExample2()">Example 2</button>
                    <button class="btn btn-secondary" onclick="generateRandom()">Random</button>
                    <button class="btn btn-warning" onclick="resetArray()">Reset</button>
                </div>

                <div class="algorithm-selector">
                    <div class="section-title">🔧 Algorithm</div>
                    <div class="algorithm-tabs">
                        <div class="algorithm-tab active" data-algorithm="extra">Extra Array</div>
                        <div class="algorithm-tab" data-algorithm="reverse">Reverse</div>
                        <div class="algorithm-tab" data-algorithm="cyclic">Cyclic</div>
                    </div>
                </div>

                <div class="control-buttons">
                    <button class="btn btn-success" id="playBtn" onclick="togglePlay()">▶️ Play</button>
                    <button class="btn btn-secondary" id="stepBtn" onclick="stepForward()">⏭️ Step</button>
                    <button class="btn btn-secondary" onclick="stepBack()">⏮️ Back</button>
                    <button class="btn btn-danger" onclick="resetVisualization()">🔄 Reset</button>
                </div>

                <div class="speed-control">
                    <label>Speed:</label>
                    <input type="range" id="speedSlider" class="slider" min="1" max="5" value="3">
                    <span id="speedLabel">Normal</span>
                </div>

                <div class="keyboard-hint">
                    ⌨️ Space: Play/Pause | ← →: Step | R: Reset
                </div>
            </div>

            <div class="visualization-panel">
                <div class="section-title">👀 Visualization</div>
                
                <div class="step-info">
                    <div class="step-counter">Step: <span id="currentStep">0</span> / <span id="totalSteps">0</span></div>
                    <div id="algorithmName">Extra Array Method</div>
                </div>

                <div class="array-container" id="arrayContainer">
                    <!-- Array elements will be generated here -->
                </div>

                <div class="before-after" id="beforeAfter" style="display: none;">
                    <div>
                        <h4>Before</h4>
                        <div id="beforeArray"></div>
                    </div>
                    <div>
                        <h4>After</h4>
                        <div id="afterArray"></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="explanation-panel">
            <div class="section-title">💡 Explanation</div>
            <div class="explanation-text" id="explanationText">
                Welcome! Choose an array and algorithm, then hit Play to see the magic happen. We'll rotate your array to the right by k steps using different approaches.
            </div>

            <div class="code-tabs">
                <div class="code-tab active" data-lang="python">Python</div>
                <div class="code-tab" data-lang="javascript">JavaScript</div>
                <div class="code-tab" data-lang="java">Java</div>
            </div>

            <div class="code-block" id="codeBlock">
                # Extra Array Method - The "Copy and Paste" Approach
def rotate(nums, k):
    n = len(nums)           # Get array length
    k = k % n              # Handle k > n (like k=10 for array of 7)
    temp = [0] * n         # Create empty temp array same size
    
    # Copy each element to its new position
    for i in range(n):
        temp[(i + k) % n] = nums[i]  # Move nums[i] to position (i+k)%n
    
    nums[:] = temp         # Copy temp back to original array
            </div>

            <div class="code-explanation" id="codeExplanation">
                <h4>🔍 What's Happening Here?</h4>
                <div id="explanationContent">
                    <p><strong>Line by line breakdown:</strong></p>
                    <ul>
                        <li><code>n = len(nums)</code> - "How many items are in our array?"</li>
                        <li><code>k = k % n</code> - "If k is bigger than n, wrap it around (like 10%7=3)"</li>
                        <li><code>temp = [0] * n</code> - "Create a blank copy of our array"</li>
                        <li><code>for i in range(n)</code> - "Look at each position in the original array"</li>
                        <li><code>temp[(i + k) % n] = nums[i]</code> - "Put each item in its new rotated position"</li>
                        <li><code>nums[:] = temp</code> - "Copy everything back to the original array"</li>
                    </ul>
                    <p><strong>Think of it like:</strong> Moving furniture to new rooms using a temporary storage room!</p>
                </div>
            </div>

            <div class="complexity-info">
                <div class="complexity-card">
                    <h4>⏱️ Time Complexity</h4>
                    <div class="big-o" id="timeComplexity">O(n)</div>
                </div>
                <div class="complexity-card">
                    <h4>💾 Space Complexity</h4>
                    <div class="big-o" id="spaceComplexity">O(n)</div>
                </div>
                <div class="complexity-card">
                    <h4>✨ Pros</h4>
                    <div id="pros">Easy to understand, straightforward</div>
                </div>
                <div class="complexity-card">
                    <h4>⚠️ Cons</h4>
                    <div id="cons">Uses extra space</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let currentArray = [1, 2, 3, 4, 5, 6, 7];
        let k = 3;
        let currentAlgorithm = 'extra';
        let currentStep = 0;
        let totalSteps = 0;
        let isPlaying = false;
        let playInterval = null;
        let speed = 3;
        let originalArray = [...currentArray];
        let steps = [];
        let currentStepIndex = 0;

        // Algorithm implementations
        const algorithms = {
            extra: {
                name: 'Extra Array Method',
                timeComplexity: 'O(n)',
                spaceComplexity: 'O(n)',
                pros: 'Easy to understand, straightforward',
                cons: 'Uses extra space',
                python: `# Extra Array Method - The "Copy and Paste" Approach
def rotate(nums, k):
    n = len(nums)           # Get array length
    k = k % n              # Handle k > n (like k=10 for array of 7)
    temp = [0] * n         # Create empty temp array same size
    
    # Copy each element to its new position
    for i in range(n):
        temp[(i + k) % n] = nums[i]  # Move nums[i] to position (i+k)%n
    
    nums[:] = temp         # Copy temp back to original array`,
                explanations: {
                    python: `<p><strong>Python Line by line breakdown:</strong></p>
                        <ul>
                            <li><code>n = len(nums)</code> - "How many items are in our array?"</li>
                            <li><code>k = k % n</code> - "If k is bigger than n, wrap it around (like 10%7=3)"</li>
                            <li><code>temp = [0] * n</code> - "Create a blank copy of our array"</li>
                            <li><code>for i in range(n)</code> - "Look at each position in the original array"</li>
                            <li><code>temp[(i + k) % n] = nums[i]</code> - "Put each item in its new rotated position"</li>
                            <li><code>nums[:] = temp</code> - "Copy everything back to the original array"</li>
                        </ul>
                        <p><strong>Think of it like:</strong> Moving furniture to new rooms using a temporary storage room!</p>`,
                    javascript: `<p><strong>JavaScript Line by line breakdown:</strong></p>
                        <ul>
                            <li><code>const n = nums.length</code> - "How many items are in our array?"</li>
                            <li><code>k = k % n</code> - "If k is bigger than n, wrap it around (like 10%7=3)"</li>
                            <li><code>const temp = new Array(n)</code> - "Create a blank copy of our array"</li>
                            <li><code>for (let i = 0; i < n; i++)</code> - "Look at each position in the original array"</li>
                            <li><code>temp[(i + k) % n] = nums[i]</code> - "Put each item in its new rotated position"</li>
                            <li><code>nums.splice(0, n, ...temp)</code> - "Replace original array with temp array"</li>
                        </ul>
                        <p><strong>Think of it like:</strong> Moving furniture to new rooms using a temporary storage room!</p>`,
                    java: `<p><strong>Java Line by line breakdown:</strong></p>
                        <ul>
                            <li><code>int n = nums.length</code> - "How many items are in our array?"</li>
                            <li><code>k = k % n</code> - "If k is bigger than n, wrap it around (like 10%7=3)"</li>
                            <li><code>int[] temp = new int[n]</code> - "Create a blank copy of our array"</li>
                            <li><code>for (int i = 0; i < n; i++)</code> - "Look at each position in the original array"</li>
                            <li><code>temp[(i + k) % n] = nums[i]</code> - "Put each item in its new rotated position"</li>
                            <li><code>for (int i = 0; i < n; i++) nums[i] = temp[i]</code> - "Copy everything back to the original array"</li>
                        </ul>
                        <p><strong>Think of it like:</strong> Moving furniture to new rooms using a temporary storage room!</p>`
                },
                javascript: `// Extra Array Method - The "Copy and Paste" Approach
function rotate(nums, k) {
    const n = nums.length;     // Get array length
    k = k % n;                 // Handle k > n (like k=10 for array of 7)
    const temp = new Array(n); // Create empty temp array same size
    
    // Copy each element to its new position
    for (let i = 0; i < n; i++) {
        temp[(i + k) % n] = nums[i];  // Move nums[i] to position (i+k)%n
    }
    
    nums.splice(0, n, ...temp); // Copy temp back to original array
}`,
                java: `// Extra Array Method - The "Copy and Paste" Approach
public void rotate(int[] nums, int k) {
    int n = nums.length;        // Get array length
    k = k % n;                  // Handle k > n (like k=10 for array of 7)
    int[] temp = new int[n];     // Create empty temp array same size
    
    // Copy each element to its new position
    for (int i = 0; i < n; i++) {
        temp[(i + k) % n] = nums[i];  // Move nums[i] to position (i+k)%n
    }
    
    // Copy temp back to original array
    for (int i = 0; i < n; i++) {
        nums[i] = temp[i];
    }
}`,
                generateSteps: (arr, k) => {
                    const steps = [];
                    const n = arr.length;
                    const temp = new Array(n);
                    
                    steps.push({
                        type: 'init',
                        message: `Starting with array [${arr.join(',')}] and k=${k}. We'll use a temporary array to store rotated values.`,
                        array: [...arr],
                        temp: [...temp]
                    });
                    
                    for (let i = 0; i < n; i++) {
                        const newIndex = (i + k) % n;
                        temp[newIndex] = arr[i];
                        
                        steps.push({
                            type: 'map',
                            message: `Move value ${arr[i]} from index ${i} to index ${newIndex} because (${i} + ${k}) % ${n} = ${newIndex}`,
                            array: [...arr],
                            temp: [...temp],
                            fromIndex: i,
                            toIndex: newIndex,
                            value: arr[i]
                        });
                    }
                    
                    steps.push({
                        type: 'copy',
                        message: `Copy all values from temp array back to original array.`,
                        array: [...temp],
                        temp: [...temp]
                    });
                    
                    return steps;
                }
            },
            
            reverse: {
                name: 'Reverse Method',
                timeComplexity: 'O(n)',
                spaceComplexity: 'O(1)',
                pros: 'In-place, constant extra space',
                cons: 'Less intuitive, requires understanding of reversals',
                python: `# Reverse Method - The "Flip and Flip Again" Trick
def rotate(nums, k):
    n = len(nums)           # Get array length
    k = k % n              # Handle k > n
    
    # Step 1: Flip the entire array upside down
    nums.reverse()         # [1,2,3,4,5,6,7] → [7,6,5,4,3,2,1]
    
    # Step 2: Flip just the first k elements back
    nums[:k] = nums[:k][::-1]  # [7,6,5,4,3,2,1] → [5,6,7,4,3,2,1]
    
    # Step 3: Flip the remaining elements back
    nums[k:] = nums[k:][::-1]  # [5,6,7,4,3,2,1] → [5,6,7,1,2,3,4]`,
                explanations: {
                    python: `<p><strong>Python Line by line breakdown:</strong></p>
                        <ul>
                            <li><code>n = len(nums)</code> - "How many items are in our array?"</li>
                            <li><code>k = k % n</code> - "If k is bigger than n, wrap it around"</li>
                            <li><code>nums.reverse()</code> - "Flip the entire array upside down"</li>
                            <li><code>nums[:k] = nums[:k][::-1]</code> - "Flip just the first k elements back"</li>
                            <li><code>nums[k:] = nums[k:][::-1]</code> - "Flip the remaining elements back"</li>
                        </ul>
                        <p><strong>Think of it like:</strong> Flipping a pancake, then flipping parts of it back!</p>`,
                    javascript: `<p><strong>JavaScript Line by line breakdown:</strong></p>
                        <ul>
                            <li><code>const n = nums.length</code> - "How many items are in our array?"</li>
                            <li><code>k = k % n</code> - "If k is bigger than n, wrap it around"</li>
                            <li><code>nums.reverse()</code> - "Flip the entire array upside down"</li>
                            <li><code>nums.splice(0, k, ...nums.slice(0, k).reverse())</code> - "Flip just the first k elements back"</li>
                            <li><code>nums.splice(k, n - k, ...nums.slice(k).reverse())</code> - "Flip the remaining elements back"</li>
                        </ul>
                        <p><strong>Think of it like:</strong> Flipping a pancake, then flipping parts of it back!</p>`,
                    java: `<p><strong>Java Line by line breakdown:</strong></p>
                        <ul>
                            <li><code>int n = nums.length</code> - "How many items are in our array?"</li>
                            <li><code>k = k % n</code> - "If k is bigger than n, wrap it around"</li>
                            <li><code>reverse(nums, 0, n - 1)</code> - "Flip the entire array upside down"</li>
                            <li><code>reverse(nums, 0, k - 1)</code> - "Flip just the first k elements back"</li>
                            <li><code>reverse(nums, k, n - 1)</code> - "Flip the remaining elements back"</li>
                            <li><code>private void reverse(int[] nums, int start, int end)</code> - "Helper method to flip array from start to end"</li>
                        </ul>
                        <p><strong>Think of it like:</strong> Flipping a pancake, then flipping parts of it back!</p>`
                },
                javascript: `// Reverse Method - The "Flip and Flip Again" Trick
function rotate(nums, k) {
    const n = nums.length;     // Get array length
    k = k % n;                 // Handle k > n
    
    // Step 1: Flip the entire array upside down
    nums.reverse();            // [1,2,3,4,5,6,7] → [7,6,5,4,3,2,1]
    
    // Step 2: Flip just the first k elements back
    nums.splice(0, k, ...nums.slice(0, k).reverse());  // [7,6,5,4,3,2,1] → [5,6,7,4,3,2,1]
    
    // Step 3: Flip the remaining elements back
    nums.splice(k, n - k, ...nums.slice(k).reverse()); // [5,6,7,4,3,2,1] → [5,6,7,1,2,3,4]
}`,
                java: `// Reverse Method - The "Flip and Flip Again" Trick
public void rotate(int[] nums, int k) {
    int n = nums.length;        // Get array length
    k = k % n;                  // Handle k > n
    
    // Step 1: Flip the entire array upside down
    reverse(nums, 0, n - 1);    // [1,2,3,4,5,6,7] → [7,6,5,4,3,2,1]
    
    // Step 2: Flip just the first k elements back
    reverse(nums, 0, k - 1);    // [7,6,5,4,3,2,1] → [5,6,7,4,3,2,1]
    
    // Step 3: Flip the remaining elements back
    reverse(nums, k, n - 1);    // [5,6,7,4,3,2,1] → [5,6,7,1,2,3,4]
}

// Helper method to reverse array from start to end
private void reverse(int[] nums, int start, int end) {
    while (start < end) {
        int temp = nums[start];
        nums[start] = nums[end];
        nums[end] = temp;
        start++;
        end--;
    }
}`,
                generateSteps: (arr, k) => {
                    const steps = [];
                    const n = arr.length;
                    let current = [...arr];
                    
                    steps.push({
                        type: 'init',
                        message: `Starting with array [${arr.join(',')}] and k=${k}. We'll use the reverse trick: flip whole → flip first k → flip rest.`,
                        array: [...current]
                    });
                    
                    // Step 1: Reverse entire array
                    current.reverse();
                    steps.push({
                        type: 'reverse',
                        message: `Step 1: Reverse entire array → [${current.join(',')}]`,
                        array: [...current],
                        reverseStart: 0,
                        reverseEnd: n - 1
                    });
                    
                    // Step 2: Reverse first k elements
                    const firstK = current.slice(0, k).reverse();
                    const rest = current.slice(k);
                    current = [...firstK, ...rest];
                    steps.push({
                        type: 'reverse',
                        message: `Step 2: Reverse first k=${k} elements → [${current.join(',')}]`,
                        array: [...current],
                        reverseStart: 0,
                        reverseEnd: k - 1
                    });
                    
                    // Step 3: Reverse remaining elements
                    const firstPart = current.slice(0, k);
                    const lastPart = current.slice(k).reverse();
                    current = [...firstPart, ...lastPart];
                    steps.push({
                        type: 'reverse',
                        message: `Step 3: Reverse remaining elements → [${current.join(',')}]`,
                        array: [...current],
                        reverseStart: k,
                        reverseEnd: n - 1
                    });
                    
                    return steps;
                }
            },
            
            cyclic: {
                name: 'Cyclic Replacements',
                timeComplexity: 'O(n)',
                spaceComplexity: 'O(1)',
                pros: 'In-place, mathematically elegant',
                cons: 'Complex to understand, requires cycle detection',
                python: `# Cyclic Replacements Method - The "Musical Chairs" Approach
def rotate(nums, k):
    n = len(nums)           # Get array length
    k = k % n              # Handle k > n
    count = 0              # Track how many elements we've moved
    start = 0              # Starting position for current cycle
    
    # Keep going until we've moved all elements
    while count < n:
        current = start    # Where we are in the cycle
        prev = nums[start] # What we're carrying
        
        # Move in a cycle until we get back to start
        while True:
            next_idx = (current + k) % n  # Where to go next
            nums[next_idx], prev = prev, nums[next_idx]  # Swap values
            current = next_idx            # Move to next position
            count += 1                    # Count this move
            
            if current == start:          # Back to start? Cycle complete!
                break
        
        start += 1        # Try next starting position`,
                explanations: {
                    python: `<p><strong>Python Line by line breakdown:</strong></p>
                        <ul>
                            <li><code>count = 0</code> - "Keep track of how many items we've moved"</li>
                            <li><code>start = 0</code> - "Where to begin our cycle"</li>
                            <li><code>while count < n</code> - "Keep going until we've moved everything"</li>
                            <li><code>current = start</code> - "Where we are right now"</li>
                            <li><code>prev = nums[start]</code> - "What we're carrying"</li>
                            <li><code>next_idx = (current + k) % n</code> - "Where to go next"</li>
                            <li><code>nums[next_idx], prev = prev, nums[next_idx]</code> - "Swap what we have with what's there"</li>
                            <li><code>if current == start</code> - "Back where we started? Cycle done!"</li>
                        </ul>
                        <p><strong>Think of it like:</strong> Musical chairs - everyone moves k seats, and we keep track of who's moved!</p>`,
                    javascript: `<p><strong>JavaScript Line by line breakdown:</strong></p>
                        <ul>
                            <li><code>let count = 0</code> - "Keep track of how many items we've moved"</li>
                            <li><code>let start = 0</code> - "Where to begin our cycle"</li>
                            <li><code>while (count < n)</code> - "Keep going until we've moved everything"</li>
                            <li><code>let current = start</code> - "Where we are right now"</li>
                            <li><code>let prev = nums[start]</code> - "What we're carrying"</li>
                            <li><code>const nextIdx = (current + k) % n</code> - "Where to go next"</li>
                            <li><code>[nums[nextIdx], prev] = [prev, nums[nextIdx]]</code> - "Swap what we have with what's there"</li>
                            <li><code>while (current !== start)</code> - "Back where we started? Cycle done!"</li>
                        </ul>
                        <p><strong>Think of it like:</strong> Musical chairs - everyone moves k seats, and we keep track of who's moved!</p>`,
                    java: `<p><strong>Java Line by line breakdown:</strong></p>
                        <ul>
                            <li><code>int count = 0</code> - "Keep track of how many items we've moved"</li>
                            <li><code>int start = 0</code> - "Where to begin our cycle"</li>
                            <li><code>while (count < n)</code> - "Keep going until we've moved everything"</li>
                            <li><code>int current = start</code> - "Where we are right now"</li>
                            <li><code>int prev = nums[start]</code> - "What we're carrying"</li>
                            <li><code>int nextIdx = (current + k) % n</code> - "Where to go next"</li>
                            <li><code>int temp = nums[nextIdx]; nums[nextIdx] = prev; prev = temp</code> - "Swap what we have with what's there"</li>
                            <li><code>while (current != start)</code> - "Back where we started? Cycle done!"</li>
                        </ul>
                        <p><strong>Think of it like:</strong> Musical chairs - everyone moves k seats, and we keep track of who's moved!</p>`
                },
                javascript: `// Cyclic Replacements Method - The "Musical Chairs" Approach
function rotate(nums, k) {
    const n = nums.length;     // Get array length
    k = k % n;                 // Handle k > n
    let count = 0;             // Track how many elements we've moved
    let start = 0;              // Starting position for current cycle
    
    // Keep going until we've moved all elements
    while (count < n) {
        let current = start;    // Where we are in the cycle
        let prev = nums[start]; // What we're carrying
        
        // Move in a cycle until we get back to start
        do {
            const nextIdx = (current + k) % n;  // Where to go next
            [nums[nextIdx], prev] = [prev, nums[nextIdx]];  // Swap values
            current = nextIdx;                   // Move to next position
            count++;                             // Count this move
        } while (current !== start);             // Back to start? Cycle complete!
        
        start++;             // Try next starting position
    }
}`,
                java: `// Cyclic Replacements Method - The "Musical Chairs" Approach
public void rotate(int[] nums, int k) {
    int n = nums.length;        // Get array length
    k = k % n;                  // Handle k > n
    int count = 0;              // Track how many elements we've moved
    int start = 0;              // Starting position for current cycle
    
    // Keep going until we've moved all elements
    while (count < n) {
        int current = start;     // Where we are in the cycle
        int prev = nums[start];  // What we're carrying
        
        // Move in a cycle until we get back to start
        do {
            int nextIdx = (current + k) % n;  // Where to go next
            int temp = nums[nextIdx];          // Save what's there
            nums[nextIdx] = prev;              // Put our value there
            prev = temp;                       // Take their value
            current = nextIdx;                 // Move to next position
            count++;                           // Count this move
        } while (current != start);            // Back to start? Cycle complete!
        
        start++;               // Try next starting position
    }
}`,
                generateSteps: (arr, k) => {
                    const steps = [];
                    const n = arr.length;
                    let current = [...arr];
                    let count = 0;
                    let start = 0;
                    const visited = new Set();
                    
                    steps.push({
                        type: 'init',
                        message: `Starting with array [${arr.join(',')}] and k=${k}. We'll move elements in cycles, tracking visited positions.`,
                        array: [...current],
                        visited: new Set()
                    });
                    
                    while (count < n) {
                        let currentIdx = start;
                        let prev = current[start];
                        const cycle = [start];
                        
                        steps.push({
                            type: 'cycle_start',
                            message: `Starting new cycle from index ${start} with value ${prev}`,
                            array: [...current],
                            visited: new Set(visited),
                            currentCycle: [...cycle],
                            currentIdx: currentIdx
                        });
                        
                        do {
                            const nextIdx = (currentIdx + k) % n;
                            const temp = current[nextIdx];
                            current[nextIdx] = prev;
                            prev = temp;
                            currentIdx = nextIdx;
                            count++;
                            cycle.push(currentIdx);
                            visited.add(currentIdx);
                            
                            steps.push({
                                type: 'cycle_move',
                                message: `Move ${prev} from index ${currentIdx} to index ${nextIdx}. Count: ${count}/${n}`,
                                array: [...current],
                                visited: new Set(visited),
                                currentCycle: [...cycle],
                                currentIdx: currentIdx,
                                fromIdx: currentIdx,
                                toIdx: nextIdx
                            });
                        } while (currentIdx !== start);
                        
                        start++;
                    }
                    
                    return steps;
                }
            }
        };

        // Initialize the app
        function init() {
            updateArrayDisplay();
            updateControls();
            setupEventListeners();
            generateSteps();
        }

        // Setup event listeners
        function setupEventListeners() {
            // Array input
            document.getElementById('arrayInput').addEventListener('input', function() {
                try {
                    const input = this.value.trim();
                    if (input) {
                        currentArray = input.split(',').map(x => parseInt(x.trim())).filter(x => !isNaN(x));
                        if (currentArray.length === 0) {
                            currentArray = [1, 2, 3, 4, 5, 6, 7];
                        }
                        originalArray = [...currentArray];
                        updateArrayDisplay();
                        generateSteps();
                    }
                } catch (e) {
                    console.error('Invalid array input:', e);
                }
            });

            // K slider and input sync
            document.getElementById('kSlider').addEventListener('input', function() {
                k = parseInt(this.value);
                document.getElementById('kInput').value = k;
                generateSteps();
            });

            document.getElementById('kInput').addEventListener('input', function() {
                k = parseInt(this.value) || 0;
                document.getElementById('kSlider').value = Math.min(k, 10);
                generateSteps();
            });

            // Algorithm tabs
            document.querySelectorAll('.algorithm-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.algorithm-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    currentAlgorithm = this.dataset.algorithm;
                    updateAlgorithmInfo();
                    generateSteps();
                });
            });

            // Code tabs
            document.querySelectorAll('.code-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.code-tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    updateCodeBlock();
                });
            });

            // Speed control
            document.getElementById('speedSlider').addEventListener('input', function() {
                speed = parseInt(this.value);
                const labels = ['Very Slow', 'Slow', 'Normal', 'Fast', 'Very Fast'];
                document.getElementById('speedLabel').textContent = labels[speed - 1];
                if (playInterval) {
                    clearInterval(playInterval);
                    startPlaying();
                }
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.code === 'Space') {
                    e.preventDefault();
                    togglePlay();
                } else if (e.code === 'ArrowRight') {
                    e.preventDefault();
                    stepForward();
                } else if (e.code === 'ArrowLeft') {
                    e.preventDefault();
                    stepBack();
                } else if (e.code === 'KeyR') {
                    e.preventDefault();
                    resetVisualization();
                }
            });
        }

        // Update array display
        function updateArrayDisplay() {
            const container = document.getElementById('arrayContainer');
            container.innerHTML = '';
            
            currentArray.forEach((value, index) => {
                const element = document.createElement('div');
                element.className = 'array-element';
                element.innerHTML = `
                    <div class="element-value">${value}</div>
                    <div class="element-index">${index}</div>
                `;
                element.dataset.index = index;
                element.dataset.value = value;
                container.appendChild(element);
            });
        }

        // Update controls
        function updateControls() {
            document.getElementById('arrayInput').value = currentArray.join(',');
            document.getElementById('kSlider').max = Math.max(currentArray.length, 10);
            document.getElementById('kInput').max = currentArray.length * 2;
        }

        // Update algorithm info
        function updateAlgorithmInfo() {
            const algo = algorithms[currentAlgorithm];
            document.getElementById('algorithmName').textContent = algo.name;
            document.getElementById('timeComplexity').textContent = algo.timeComplexity;
            document.getElementById('spaceComplexity').textContent = algo.spaceComplexity;
            document.getElementById('pros').textContent = algo.pros;
            document.getElementById('cons').textContent = algo.cons;
            updateCodeBlock();
        }

        // Update code block
        function updateCodeBlock() {
            const algo = algorithms[currentAlgorithm];
            const activeLang = document.querySelector('.code-tab.active').dataset.lang;
            document.getElementById('codeBlock').textContent = algo[activeLang];
            document.getElementById('explanationContent').innerHTML = algo.explanations[activeLang];
        }

        // Generate steps for current algorithm
        function generateSteps() {
            steps = algorithms[currentAlgorithm].generateSteps(currentArray, k);
            totalSteps = steps.length;
            currentStepIndex = 0;
            document.getElementById('totalSteps').textContent = totalSteps;
            document.getElementById('currentStep').textContent = currentStepIndex;
            
            if (steps.length > 0) {
                updateExplanation(steps[0].message);
            }
        }

        // Update explanation
        function updateExplanation(message) {
            document.getElementById('explanationText').textContent = message;
        }

        // Visualize current step
        function visualizeStep(step) {
            const elements = document.querySelectorAll('.array-element');
            
            // Clear all highlights
            elements.forEach(el => {
                el.classList.remove('highlighted', 'active', 'visited', 'moving');
            });
            
            // Remove existing arrows
            document.querySelectorAll('.arrow').forEach(arrow => arrow.remove());
            
            if (step.type === 'map') {
                // Highlight source and destination
                elements[step.fromIndex].classList.add('highlighted');
                elements[step.toIndex].classList.add('active');
                
                // Add arrow
                const arrow = document.createElement('div');
                arrow.className = 'arrow';
                arrow.textContent = '→';
                arrow.style.left = `${step.fromIndex * 70 + 30}px`;
                arrow.style.top = '-10px';
                document.getElementById('arrayContainer').appendChild(arrow);
                
            } else if (step.type === 'reverse') {
                // Highlight reversed range
                for (let i = step.reverseStart; i <= step.reverseEnd; i++) {
                    elements[i].classList.add('highlighted');
                }
                
            } else if (step.type === 'cycle_start') {
                elements[step.currentIdx].classList.add('active');
                
            } else if (step.type === 'cycle_move') {
                elements[step.fromIdx].classList.add('visited');
                elements[step.toIdx].classList.add('active');
            }
            
            // Update array values if they changed
            if (step.array) {
                currentArray = [...step.array];
                updateArrayDisplay();
                visualizeStep(step); // Re-apply visualization after update
            }
        }

        // Step forward
        function stepForward() {
            if (currentStepIndex < steps.length - 1) {
                currentStepIndex++;
                const step = steps[currentStepIndex];
                visualizeStep(step);
                updateExplanation(step.message);
                document.getElementById('currentStep').textContent = currentStepIndex + 1;
                
                if (currentStepIndex === steps.length - 1) {
                    showBeforeAfter();
                }
            }
        }

        // Step backward
        function stepBack() {
            if (currentStepIndex > 0) {
                currentStepIndex--;
                const step = steps[currentStepIndex];
                visualizeStep(step);
                updateExplanation(step.message);
                document.getElementById('currentStep').textContent = currentStepIndex + 1;
                
                if (currentStepIndex < steps.length - 1) {
                    document.getElementById('beforeAfter').style.display = 'none';
                }
            }
        }

        // Toggle play/pause
        function togglePlay() {
            if (isPlaying) {
                pausePlaying();
            } else {
                startPlaying();
            }
        }

        // Start playing
        function startPlaying() {
            isPlaying = true;
            document.getElementById('playBtn').textContent = '⏸️ Pause';
            
            const speeds = [2000, 1500, 1000, 500, 250];
            playInterval = setInterval(() => {
                if (currentStepIndex < steps.length - 1) {
                    stepForward();
                } else {
                    pausePlaying();
                }
            }, speeds[speed - 1]);
        }

        // Pause playing
        function pausePlaying() {
            isPlaying = false;
            document.getElementById('playBtn').textContent = '▶️ Play';
            if (playInterval) {
                clearInterval(playInterval);
                playInterval = null;
            }
        }

        // Reset visualization
        function resetVisualization() {
            pausePlaying();
            currentArray = [...originalArray];
            currentStepIndex = 0;
            updateArrayDisplay();
            generateSteps();
            document.getElementById('beforeAfter').style.display = 'none';
            
            // Clear highlights
            document.querySelectorAll('.array-element').forEach(el => {
                el.classList.remove('highlighted', 'active', 'visited', 'moving');
            });
            document.querySelectorAll('.arrow').forEach(arrow => arrow.remove());
        }

        // Show before/after comparison
        function showBeforeAfter() {
            document.getElementById('beforeAfter').style.display = 'grid';
            document.getElementById('beforeArray').textContent = `[${originalArray.join(', ')}]`;
            document.getElementById('afterArray').textContent = `[${currentArray.join(', ')}]`;
        }

        // Preset functions
        function loadExample1() {
            currentArray = [1, 2, 3, 4, 5, 6, 7];
            k = 3;
            originalArray = [...currentArray];
            updateControls();
            generateSteps();
            resetVisualization();
        }

        function loadExample2() {
            currentArray = [-1, -100, 3, 99];
            k = 2;
            originalArray = [...currentArray];
            updateControls();
            generateSteps();
            resetVisualization();
        }

        function generateRandom() {
            const length = Math.floor(Math.random() * 8) + 3; // 3-10 elements
            currentArray = Array.from({length}, () => Math.floor(Math.random() * 20) - 10);
            k = Math.floor(Math.random() * length) + 1;
            originalArray = [...currentArray];
            updateControls();
            generateSteps();
            resetVisualization();
        }

        function resetArray() {
            currentArray = [1, 2, 3, 4, 5, 6, 7];
            k = 3;
            originalArray = [...currentArray];
            updateControls();
            generateSteps();
            resetVisualization();
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
